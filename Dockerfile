FROM ruby:2.6.5-alpine

# Install important dependencies
RUN apk add build-base nodejs yarn tzdata sqlite-dev postgresql-client postgresql-dev python imagemagick 

RUN gem install bundler -v 1.16.1
RUN gem install rails -v '5.2.3'

RUN mkdir -p /myapp && chmod -R 777 /myapp
WORKDIR /myapp

COPY Gemfile* /myapp/

RUN bundle install

COPY . /myapp/

RUN chmod -R 777 /myapp

ENV RAILS_ENV development
ENV SECRET_KEY_BASE 123456789
ENV GOOGLE_CREDENTIALS ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAicmFpbHMtbGFiLTI2NDYwMCIsCiAgInByaXZhdGVfa2V5X2lkIjogImIxOTcwZjAwZjAxZGIxODJjMDNlNGJhY2VjZmQ1NTVlNGMzYjgxNTciLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktZd2dnU2lBZ0VBQW9JQkFRRGIwZDZjVVR1SFpXbFhcbmxjWW5UVlhRNGM0M2lyaU4ycHptZWQ1L3ZDMHg1bGxYcGFJSkVlSHVnWkVGRzRGZ1lvYzlEc09sc1FVb2VvbkpcbnRYMDlkVFVrQy95SGVKOXlIL3RjUDBwbiszRUR6bGt1d3EzazIwU3Zjd1ZHY0tIendEcmVUUGVkNGRuamlWYUtcbmh4YXo1QXBXWFJYUUEzNVdUMUttNGpYRElQTis1UGZiWFFYTDF4SEI2MkNZa25Pcnk5YTBLd2l4Z1BieXdBZlJcbjlZOTdrRi8yT0llVXJtR3lOTitjclZGSTd5RnRlK0MxTzBGUHZxbmNpYmgzVzRYaEZBZGJXL3NOUnhTWmZGbUpcbmhVd0pFM293WE02bndFK1kyMFZWOGVmRkZWb2RYSFp2aGpTc3cyNkFOeHEyS2xyQzJ2eHd5RlhQcENZS1RQVFJcbmFPbEhEN3p6QWdNQkFBRUNnZ0VBRXlCL1RMMjZ2c3pCcmtmUGZxTDVpUnZrekN0clpKaDFsNDVhSUdZNHpvTTdcbkdlZkZJaUhtdFZDYjFFUnc3UGlWeU9mTWVWSGVYNGZPRG5tV3hLNjZxWURMZitRc2g0c2wzWUI2VW5Mc0FnZEZcbjlrNGxRR2tkNEdCVFFLNVRRVGprUm15UERUTldPTGkrQ1g2NHFIMTZzc29WdUV4ZGhWZ1Ftb25MWU1ld3VFVTlcbnpOTGZnL3laeDBNVFlXRVdvNC9FL01zL1JBdFdKR0JyZWZtYUFoR0dzbXhKaFF3ZU93NFJaTEFuUGZ0NDlLQndcblhRNUZRb1doVDRHNjdScVBqaS91Ym1TTWFaRlFOK0pYYWc2Lzc1dktOUnJ3RjhvQW85dFFTbDlYNUdIeXRwaE9cbnE2RXdoVmFPeWY4MHBJTExwOEtNMHJLd0JUMHJUcmRTL3IxWXVmd1VZUUtCZ1FEdjRXaXYxQTU1Q3p1djVTbHJcbkRMS1VSU2N3Z2F2TjRIc0dvRzZ3clkyM09GVlB1NlVpNlNtcFBKN0ZzVm0vVmk0enNESmF2STZZSVV1Z2pCNkZcbk5OaURFbFdEMmlaWmtycVBWZ3hvSFdVbGJHTFE5MTFBYldzM1Y4VWFIczhFbm9STDJ1blRTWDhIOHZkUjFhM1Vcbk5XNHdRNlJzV3RHWWROb0dwRDc5Rk41cTRRS0JnUURxbDF6TzNyU3lmUFlDRWhjVTJSVGhXYjl5cSs4Q25IMjFcbjZjNnpBUjU3Q3hxQmhpTEJGQXZBNFR1d0d5MHd0R2puVmR1Y3dpWitBWlpnc242ZzRpQnJNcnlydzRQRjh1bHFcbnB0YTlFb3crVXU0eW9TL0FEWVRWVkg5WlVwb2s1YmNBVVNUQjRoWFJuajNDSEdBOFhXenpjanJBb1R3MHFCNU1cbllYTERLL3ZXVXdLQmdDYWJyUEcvdTZTWHZqK05McUZnSmMzZlkzTlhLNE96UVpuTGNJVlhLWnYzb1NONEhCZ0dcblZ3STZFNFBXQzQvVUd4T09wRXdlVlFUL051RGNMSDFjQ0F6d2ducjZQWG5sTjhtaUc5VVdCaFdENEZPcHZJU0dcbkY5K01iTmpMWko1bHRQMVFlcG5iRm1yOUcvazczd0pzcHhOMWo1MHc4Tk1NMjVwK0RQVkd5cFdCQW9HQVcvTm9cblZVM0YxaEJVL1FyS01VbkZmVzhJTTVKZzVNMGlHU1BEK1RYL0ZJdU5vQ2RMaUJLcmFMYmdCbThnajI2bmo4Vi9cbmh6b3lqRUZqQ0JQdXZuRGo5Q0MzQXp4bmNqZDhkbWxlMGsxcTJ5TDJhckh6WFh2dkRROUp1MkU5T2lrd1NkZUVcbmFOcU5ZdFI3c0pJZXhvcDRJaFFzSTBVUHJEUVpiQ2JtTE1vWXRERUNnWUJkZTczYVp5NWFZU3ExUWw5Wkczbm9cbmpJMWhMUzRTWm45RVY4QnJLU2pOeTdRcUYxenJqcExMU1lkcndsMGJGMW9JeE1NdUdhUW02dUJaeUtzOE51Q3ZcbjhKWlBSb0p1RkNOM0ZQMSt0amQwdnFJUG1oTk9pSVpiWUs5UmNsSkR1WDRsUGRTNFhycE5qd0hTOTJVTm1pWmxcbjFFWnZmSHVKTnZjL0VDZjZGc1dUZ0E9PVxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogInRlc3RlLXJhaWxzLWdjc0ByYWlscy1sYWItMjY0NjAwLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjExMTU5MzY2NzcwMjIzMjQxMTg2NCIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvdGVzdGUtcmFpbHMtZ2NzJTQwcmFpbHMtbGFiLTI2NDYwMC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIKfQo=

RUN bin/rails assets:precompile

ENTRYPOINT rails s -b 0.0.0.0
